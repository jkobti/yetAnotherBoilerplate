enabled: true

kube-prometheus-stack:
  enabled: true
  fullnameOverride: "prometheus"

  defaultRules:
    create: true
    rules:
      etcd: false
      kubeScheduler: false

  alertmanager:
    enabled: true

  grafana:
    enabled: true
    adminPassword: "admin" # TODO: Change via secret in production
    service:
      type: NodePort
      nodePort: 30000
    ingress:
      enabled: false
      ingressClassName: nginx
      hosts:
        - grafana.local.dev
    sidecar:
      dashboards:
        enabled: true
        label: grafana_dashboard
      datasources:
        enabled: true
        defaultDatasourceEnabled: true
    additionalDataSources:
      - name: Loki
        type: loki
        url: http://observability-loki:3100
        access: proxy
        isDefault: false
        jsonData:
          derivedFields:
            - datasourceUid: prometheus
              matcherRegex: "trace_id=(\\w+)"
              name: TraceID
              url: "$${__value.raw}"

  prometheus:
    enabled: true
    prometheusSpec:
      # Allow Prometheus to scrape ServiceMonitors from all namespaces
      serviceMonitorSelectorNilUsesHelmValues: false
      serviceMonitorSelector: {}
      serviceMonitorNamespaceSelector: {}

      # Allow Prometheus to scrape PodMonitors from all namespaces
      podMonitorSelectorNilUsesHelmValues: false
      podMonitorSelector: {}
      podMonitorNamespaceSelector: {}

      # Allow Prometheus to scrape PrometheusRules from all namespaces
      ruleSelectorNilUsesHelmValues: false
      ruleSelector: {}
      ruleNamespaceSelector: {}

loki-stack:
  enabled: true
  loki:
    enabled: true
    commonConfig:
      replication_factor: 1
    storage:
      type: 'filesystem'
  promtail:
    enabled: true
    config:
      clients:
        - url: http://observability-loki:3100/loki/api/v1/push
  grafana:
    enabled: false # We use the grafana from kube-prometheus-stack
